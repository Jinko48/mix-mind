{# template for admin to manage ingredient stock #}
{% extends "base.html" %}
{% from "_macros.html" import formheader, render_field %}

{% block modal %}
<div class="modal fade {% if form_open %} show{% endif %}" id="add-ingredient" tabindex="-1" role="dialog">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Add Ingredient</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<form  id="add-ingredient-form" action="" method="post" role="form">
				<div class="modal-body">
					{{ form.csrf }}
					{# TODO form layout #}
					{{ render_field(form.bottle) }}
					{{ render_field(form.category) }}
					{{ render_field(form.type_) }}
					{{ render_field(form.abv) }}
					{{ render_field(form.size) }}
					{{ render_field(form.unit) }}
					{{ render_field(form.price) }}
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-outline-secondary" onclick="clearModalForm()" data-dismiss="modal">Close</button>
					<input type="submit" class="btn btn-success" target="_blank" name="add-ingredient" value="Add"></input>
				</div>
			</form>
		</div>
	</div>
</div>

{# TODO "info" modal that includes detailed information about the up/downloads
the various fields for an "ingredient" #}
<div class="modal" id="info-panel" tabindex="-1" role="dialog">
	<div class="modal-dialog modal-dialog-centered" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Ingredients</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<h4>What defines an "Ingredient"?</h4>
				<p>Simply a unique ingredient that is used for making drinks. This will mostly be the bottles of alcohol stocked at your bar, but it includes things like syrups, juices, and dry ingredients like sugar. This program requires you to be a little more specific than just "rum", and instead to specify a brand or specific bottle such as "Bacardi Carta Blanca" in addition to what type of ingredient it is, "white rum". The brand/bottle along with the type of ingredient is what uniquely identifies it. This allows the program to generate all the different ways to make each drink, the "examples" section when viewing a menu item in detail. For example, if you're looking at a <a href="/order/Martini">Martini</a>, you'll see every combination of dry gin and dry vermouth that could be used to make it.</p>
				<h4>CSV Import/Export Format</h4>
				<p>A CSV file can be supplied to initialize (or replace, or update) the ingredient database.</p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>

<div class="modal" id="confirm-delete-ingredient" tabindex="-1" role="dialog">
	<div class="modal-dialog modal-dialog-centered" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Delete Ingredient</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<p>Are you sure you want to delete this ingredient from the database?</p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>
				<button type="button" class="btn btn-danger">Confirm Delete</button>
			</div>
		</div>
	</div>
</div>

<div class="modal" id="upload-csv-modal" tabindex="-1" role="dialog">
	<div class="modal-dialog modal-dialog-centered" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Upload Ingredients File</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<form id="upload-csv-form" method="post" role="form" enctype="multipart/form-data">
					{{ upload_form.csrf }}
					{{ render_field(upload_form.upload_csv) }}
					{{ render_field(upload_form.replace_existing) }}
					<input type="submit" class="btn btn-primary" target="_blank" name="upload-csv" value="Upload"></input>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>
{% endblock modal %}

{% block body %}
<div class="container my-3">
	{{ formheader("Ingredient Stock", "&nbsp;Manage the ingredients at {}".format(g.current_bar.cname)) }}

	{# info, upload, download buttons #}
	<div id="controls" class="row no-gutters d-none">
		<div class="col-auto mr-auto">
			<button type="button" class="close" data-target="#info-panel" data-toggle="modal">
				<i class="fas fa-info"></i><span class="close-btn-txt">Info</span>
			</button>
		</div>

		<div class="col-auto mr-auto">
			<button type="button" class="btn close" data-target="#upload-csv-modal" data-toggle="modal">
				<i class="fas fa-file-upload"></i><span class="close-btn-txt">Import</span>
			</button>
		</div>

		<div class="col-auto">
			<form id="download_csv" action="/api/ingredients/download" method="get" role="form" enctype="multipart/form-data">
				<button type="submit" class="close" target="_blank" name="download-csv">
					<i class="fas fa-file-download"></i><span class="close-btn-txt">Export</span>
				</button>
			</form>
		</div>
	</div>

	<div class="table-responsive">
		<table id="barstock-table" class="table">
			<thead>
				<tr>
					<th scope="col"><button type="button" data-target="#add-ingredient" data-toggle="modal" title="Add an ingredient" class="close"><i class="fas fa-plus"></i></button></th>
					<th scope="col"></th>
					<th scope="col">In Stock</th>
					<th scope="col">Category</th>
					<th scope="col">Type</th>
					<th scope="col">Ingredient</th>
					<th scope="col">ABV</th>
					<th scope="col">Size</th>
					<th scope="col">Size</th>
					<th scope="col">Price</th>
					<th scope="col">$/oz</th>
				</tr>
			</thead>
		</table>
	</div>

</div>
{% endblock body %}

{% block scripts %}
<script src="/static/js/ingredient_table.js?v=1.1"></script>
{% endblock scripts %}
