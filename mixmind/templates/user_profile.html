{# template for user (or admin) to view their profile #}
{% extends "form_base.html" %}
{% from "_macros.html" import show_flashed, render_field %}

{% block formblock %}
<div class="row my-3">
	<h3 class="col-auto mr-auto">{{ current_user.get_name() }} {% if current_user.nickname %}({{ current_user.nickname }}){% endif %}</h3>
	<div class="col-auto">
		<a href="#edit-user-container" data-toggle="collapse" class="btn btn-lg btn-outline-primary">Edit Profile</a>
	</div>
</div>
{{ show_flashed() }}
<div id="edit-user-container" class="collapse mb-3">
	<form id="edit-user" method="post" role="form">
		{{ edit_user.csrf }}
		{{ render_field(edit_user.first_name) }}
		{{ render_field(edit_user.last_name) }}
		{{ render_field(edit_user.nickname) }}
		{{ render_field(edit_user.venmo_id) }}
		{{ render_field(edit_user.submit) }}
	</form>
</div>

{# TODO collapse this table when editing profile #}
<table class="table">
	<tr>
		<th scope="row">Email</th>
		<td>{{ current_user.email }}</td>
	</tr>
	<tr>
		<th scope="row">Current Login</th>
		<td>{{ current_user.current_login_at }}</td>
	</tr>
	<tr>
		<th scope="row">Login IP</th>
		<td>{{ current_user.current_login_ip }}</td>
	</tr>
	<tr>
		<th scope="row">Roles</th>
		<td>{{ current_user.get_role_names() }}</td>
	</tr>
{% if 'bartender' in current_user.get_role_names() %}
	<tr>
		<th scope="row">Works at</th>
		<td>{{ current_user.get_bar_names() }}</td>
	</tr>
{% endif %}
{% if current_user.venmo_id %}
	</tr>
		<th scope="row">Venmo ID</th>
		<td>{{ current_user.venmo_id }}</td>
	</tr>
{% endif %}
</table>

<h5>Order history:</h5>
<table>
	<tr>
		<th>What</th>
		<th>Where</th>
		<th>When</th>
		<th>Confirmed</th>
	</tr>
	{% for order in current_user.orders %}
	<tr>
		<td>{{ order.recipe_name }}</td>
		<td>{{ order.where() }}</td>
		<td>{{ order.timestamp }}</td>
		<td>{{ order.confirmed }}</td>
	</tr>
	{% endfor %}
</table>
{% endblock formblock %}
